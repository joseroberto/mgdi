FROM synapsetec/nodejs:node8

ADD . /var/opt/mgi

WORKDIR /var/opt/mgi

RUN mkdir -p /var/opt/mgi && \
  mkdir /.pm2 && \
  chgrp -R 0 /.pm2 && \
  chmod -R g+rwX /.pm2

RUN apt-get update && \
apt-get install git -y && \
npm install && \
chgrp -R 0 /var/opt/mgi && \
chmod -R g+rwX /var/opt/mgi && \
mkdir /var/opt/server_log && \
chgrp -R 0 /var/opt/server_log && \
chmod -R g+rwX /var/opt/server_log

EXPOSE 8000
USER 1001
WORKDIR /var/opt/mgi

CMD [ "pm2-runtime", "config/pm2-api.config.yaml"]